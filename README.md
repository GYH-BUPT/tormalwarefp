# tormalwarefp
**Goal:** Tor malware C&C detection and classification using traffic analysis on encrypted Tor traffic.


**Main file: classify_topk.py**

USAGE: python(3.7) classify_topk.py **--options** [options_file] **--topk** [topk] **--train/zeroday**

**[options_file]:** Options file defining parameter inputs for classification

**[topk]:** Use top-1 or top-3 most active Tor connections (connections with most activity)
  
**[train]:** Use this to train models for binary/multi-label classification
  
**[zeroday]:** Use this option to test trained models on provided zeroday data
  
**Datasets provided:**
1. train_D5 : Data used for train/test classification models
2. zerodaytestdata.zip : Zero day test data for testing trained models


**Option files provided:**
  1. options-5imbalanced
  2. options-5imbalanced_host
  3. options-zeroday_binary
  4. options-zeroday_multilabel

## Binary Classification (Train(on 70% connections)/Test(on 30% connections)): Classify malware and benign Tor connections
#### Scenarios:
**Note: Set 'MULTICLASS' option to 0 in options file**
  
1. D5, imbalanced, top k = 3, with only CONNECTION-LEVEL features (Hayes 2016)

    cmd: python classify_topk.py --options **options-5imbalanced** --topk **3** **--train**

2. D5, imbalanced, top k = 3, with CONNECTION+HOST-LEVEL features

    cmd: python classify_topk.py --options **options-5imbalanced_host** --topk **3** **--train**
 
## Multi-label Classification (Train/Test): Identify malware class of malware connections
**Note: Set 'MULTICLASS' option to 2 in options file for this mode**
  
Same commands 1. and 2. as used in binary classification.
  
## Zero Day Test using B1 and B2 malware binary instances of EternalRocks malware
  
1. Identify Tor malware connections in zeroday data (zerodaytestdata/)

    cmd: python classify_topk.py --options **options-zeroday_binary** --topk **3** **--zeroday**

2. Identify malware class of Tor malware connections in zeroday data (zerodaytestdata/)

    cmd: python classify_topk.py --options **options-zeroday_multilabel** --topk **3** **--zeroday**
  

##### Note: All experiments can be run with topk=1 or topk=3 (optimal results achieved when top3 most active Tor connections are used for training&testing). For balanced/imbalanced training mode, change 'BEN_INSTEND' value in options file as per instructions provided.
