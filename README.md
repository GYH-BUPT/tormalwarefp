# tormalwarefp
**Goal:** Tor malware C&C detection and classification using traffic analysis on encrypted Tor traffic.


**Main file: classify_topk.py**

**USAGE:** python(3.7) classify_topk.py **--options** [options_file] **--topk** [topk] **--train/zeroday**

**[options_file]:** Options file defining parameter inputs for classification

**[topk]:** Use k=1 or k=3 for topk most active Tor connections (connections with most activity)
  
**[train]:** Set option to train models for binary/multi-label classification
  
**[zeroday]:** Set option to test trained models on provided zeroday data
  
**Datasets provided:**
1. train_D5 : Data used for train classification models
2. zerodaytest.zip : Zero day data for testing the trained models on unseen malware Tor traffic


**Option files provided:**
  1. options-D5
  2. options-D5_host
  3. options-zeroday_binary
  4. options-zeroday_multilabel

## Binary Classification: Classify malware and benign Tor connections
#### Scenarios:
**Note: 'MULTICLASS' option 0 in options file**
  
1. D5, top k = 3, with only CONNECTION-LEVEL features [Hayes et al. 2016]

    cmd: python classify_topk.py --options **options-D5** --topk **3** **--train**

2. D5, top k = 3, with CONNECTION+HOST-LEVEL features [Dodia et al. 2022]

    cmd: python classify_topk.py --options **options-D5_host** --topk **3** **--train**
 
## Multi-label Classification: Identify malware class of malicious Tor connections
**Note: Set 'MULTICLASS' option to 1 in options file**
  
Same commands 1. and 2. as used in binary classification.
  
## Zeroday Test: On traffic from new EternalRocks binaries unseen by models
  
1. Identify zeroday malware connections

    cmd: python classify_topk.py --options **options-zeroday_binary** --topk **3** **--zeroday**

2. Identify type of malware (class labels)

    cmd: python classify_topk.py --options **options-zeroday_multilabel** --topk **3** **--zeroday**
  

##### Note: 
* All experiments can be run with topk=1 or topk=3 (optimal results achieved when top3 most active Tor connections are used for training & testing). 
* Host features can be activated/deactivated by setting HOSTFTS to True/False or commenting in/out in the options file. 
* Models trained with HOSTFTS, must be tested with HOSTFTS option activated in the test (ie. in the zeroday option files).
